\chapter{Large and small kernels}
\label{ch:ker}

In this chapter we use \Cref{cor:semi_lie_combo} to prove
both \Cref{thm:semi_lie_ker_trivial} and \Cref{thm:semi_lie_ker_huge}
for the orbital integral on $S_2(F) \times V'_2(F)$,
We also comment on an analogous result for $S_3(F)$,
although we do not provide all the details.

We assume $\guv$ is as in \Cref{lem:semi_lie_params} throughout this chapter.

\section{In the semi-Lie case, the kernel is trivial if we allow $v(e)$ to vary, for every fixed choice of $\gamma$}
We prove \Cref{thm:semi_lie_ker_trivial} in this section.
We treat $\gamma$ as fixed, and let
\[ \theta \coloneqq \min\left( v(b)+v(c), 2v(d-a) \right) \ge 0 \]
as we did in \Cref{ch:orbitalFJ1}.

\begin{lemma}
  \label{lem:semi_lie_ker_full_rank}
  Fix $\gamma$. Let $N \ge 0$ be a nonnegative integer.
  We define an $(N+ \left\lfloor \frac{\theta}{2} \right\rfloor + 2) \times (N+1)$ matrix $M$ as follows:
  for $0 \le i \le N+ \left\lfloor \frac{\theta}{2} \right\rfloor + 1$ and $0 \le r \le N$,
  the $i$\ts{th} row and $r$\ts{th} column takes the value
  \[
    M_{i,r} \coloneqq \frac{(-1)^r}{\log q} \partial \Orb\left(
      \left(\gamma, \begin{pmatrix} 0 \\ 1 \end{pmatrix}, \begin{pmatrix} 0 & \varpi^i \end{pmatrix} \right),
      \mathbf{1}_{K', \le r} \right).
  \]
  Then $M$ has full rank.
\end{lemma}
The basic strategy of the proof will be to perform some sequences of row operations.
Specifically, we introduce the following definition.
\begin{itemize}
  \ii For each $i = N + \left\lfloor \frac{\theta}{2} \right\rfloor,\dots,0$ in that order,
  subtract the $i$\ts{th} row of $M$
  from the $(i+1)$\ts{th} row of $M$.
  Denote the new matrix as $M'$.

  \ii For each $i = N + \left\lfloor \frac{\theta}{2} \right\rfloor - 1,\dots,0$ in that order,
  subtract the $i$\ts{th} row of $M'$
  from the $(i+2)$\ts{nd} row of $M'$.
  Denote the new matrix as $M''$.
\end{itemize}
Then the basic premise is to show that $M''$ has an upper triangular submatrix.
This is easier to see with some illustrations, which we give below.

\begin{example}
  For example, for $N = 4$ and $v(b)+v(c)=1$, $v(d-a) = 0$ (hence $\theta = 0$), we have
  \[
    M = \begin{pmatrix}
    1 & 2 & 3 & 4 & 5 \\
    1 & q + 3 & 2q + 4 & 3q + 5 & 4q + 6 \\
    2 & q + 4 & q^{2} + 3q + 5 & 2q^{2} + 4q + 6 & 3q^{2} + 5q + 7 \\
    2 & 2q + 5 & q^{2} + 4q + 6 & q^{3} + 3q^{2} + 5q + 7 & 2q^{3} + 4q^{2} + 6q + 8 \\
    3 & 2q + 6 & 2q^{2} + 5q + 7 & q^{3} + 4q^{2} + 6q + 8 & q^{4} + 3q^{3} + 5q^{2} + 7q + 9 \\
    3 & 3q + 7 & 2q^{2} + 6q + 8 & 2q^{3} + 5q^{2} + 7q + 9 & q^{4} + 4q^{3} + 6q^{2} + 8q + 10
    \end{pmatrix}
  \]
  hence
  \[ M'= \begin{pmatrix}
    1 & 2 & 3 & 4 & 5 \\
    0 & q + 1 & 2q + 1 & 3q + 1 & 4q + 1 \\
    1 & 1 & q^{2} + q + 1 & 2q^{2} + q + 1 & 3q^{2} + q + 1 \\
    0 & q + 1 & q + 1 & q^{3} + q^{2} + q + 1 & 2q^{3} + q^{2} + q + 1 \\
    1 & 1 & q^{2} + q + 1 & q^{2} + q + 1 & q^{4} + q^{3} + q^{2} + q + 1 \\
    0 & q + 1 & q + 1 & q^{3} + q^{2} + q + 1 & q^{3} + q^{2} + q + 1
    \end{pmatrix}
  \]
  and finally
  \[ M'' = \begin{pmatrix}
    1 & 2 & 3 & 4 & 5 \\
    0 & q + 1 & 2q + 1 & 3q + 1 & 4q + 1 \\
    0 & -1 & q^{2} + q - 2 & 2q^{2} + q - 3 & 3q^{2} + q - 4 \\
    0 & 0 & -q & q^{3} + q^{2} - 2q & 2q^{3} + q^{2} - 3q \\
    0 & 0 & 0 & -q^{2} & q^{4} + q^{3} - 2q^{2} \\
    0 & 0 & 0 & 0 & -q^{3}
    \end{pmatrix}. \]
\end{example}

\begin{example}
  For example, for $N = 4$, $v(b)+v(c)=17$, $v(d-a) = 2$ (hence $\theta=4$), we have
  \[
    M = \begin{pmatrix}
    9 & 10 & 11 & \dots \\
    8q + 10 & 9q + 11 & 10q + 12 & \dots \\
    7q^{2} + 9q + 11 & 8q^{2} + 10q + 12 & 9q^{2} + 11q + 13 & \dots \\
    q^{2} + 10q + 12 & 7q^{3} + 9q^{2} + 11q + 13 & 8q^{3} + 10q^{2} + 12q + 14 & \dots \\
    8q^{2} + 11q + 13 & q^{3} + 10q^{2} + 12q + 14 & 7q^{4} + 9q^{3} + 11q^{2} + 13q + 15 & \dots \\
    2q^{2} + 12q + 14 & 8q^{3} + 11q^{2} + 13q + 15 & q^{4} + 10q^{3} + 12q^{2} + 14q + 16 & \dots \\
    9q^{2} + 13q + 15 & 2q^{3} + 12q^{2} + 14q + 16 & 8q^{4} + 11q^{3} + 13q^{2} + 15q + 17 & \dots \\
    3q^{2} + 14q + 16 & 9q^{3} + 13q^{2} + 15q + 17 & 2q^{4} + 12q^{3} + 14q^{2} + 16q + 18 & \dots
    \end{pmatrix}
  \]
  hence
  \[ M' = \begin{pmatrix}
    9 & 10 & 11 & 12 & \dots \\
    8q + 1 & 9q + 1 & 10q + 1 & 11q + 1 & \dots \\
    7q^{2} + q + 1 & 8q^{2} + q + 1 & 9q^{2} + q + 1 & 10q^{2} + q + 1 & \dots \\
    -6q^{2} + q + 1 & 7q^{3} + q^{2} + q + 1 & 8q^{3} + q^{2} + q + 1 & 9q^{3} + q^{2} + q + 1 & \dots \\
    7q^{2} + q + 1 & -6q^{3} + q^{2} + q + 1 & 7q^{4} + q^{3} + q^{2} + q + 1 & 8q^{4} + \dots + 1 & \dots \\
    -6q^{2} + q + 1 & 7q^{3} + q^{2} + q + 1 & -6q^{4} + q^{3} + q^{2} + q + 1 & 7q^{5} + \dots + 1 & \dots \\
    7q^{2} + q + 1 & -6q^{3} + q^{2} + q + 1 & 7q^{4} + q^{3} + q^{2} + q + 1 & -6q^{5} + \dots + 1 & \dots \\
    -6q^{2} + q + 1 & 7q^{3} + q^{2} + q + 1 & -6q^{4} + q^{3} + q^{2} + q + 1 & 7q^{5} + \dots + 1 & \dots
    \end{pmatrix}
  \]
  and finally
  \[
    M'' = \begin{pmatrix}
    9 & 10 & 11 & 12 & 13 \\
    8q + 1 & 9q + 1 & 10q + 1 & 11q + 1 & 12q + 1 \\
    7q^{2} + q - 8 & 8q^{2} + q - 9 & 9q^{2} + q - 10 & 10q^{2} + q - 11 & 11q^{2} + q - 12 \\
    -6q^{2} - 7q & 7q^{3} + q^{2} - 8q & 8q^{3} + q^{2} - 9q & 9q^{3} + q^{2} - 10q & 10q^{3} + q^{2} - 11q \\
    0 & -6q^{3} - 7q^{2} & 7q^{4} + q^{3} - 8q^{2} & 8q^{4} + q^{3} - 9q^{2} & 9q^{4} + q^{3} - 10q^{2} \\
    0 & 0 & -6q^{4} - 7q^{3} & 7q^{5} + q^{4} - 8q^{3} & 8q^{5} + q^{4} - 9q^{3} \\
    0 & 0 & 0 & -6q^{5} - 7q^{4} & 7q^{6} + q^{5} - 8q^{4} \\
    0 & 0 & 0 & 0 & -6q^{6} - 7q^{5}
    \end{pmatrix}.
  \]
\end{example}
\begin{example}
  For example, for $N = 4$, $v(b)+v(c)=5$, $v(d-a) = 8$ (hence $\theta=5$), we have
  \[ M = \begin{pmatrix}
    3 & 4 & 5 & \dots \\
    2q + 4 & 3q + 5 & 4q + 6 & \dots \\
    q^{2} + 3q + 5 & 2q^{2} + 4q + 6 & 3q^{2} + 5q + 7 & \dots \\
    2q^{2} + 4q + 6 & q^{3} + 3q^{2} + 5q + 7 & 2q^{3} + 4q^{2} + 6q + 8 & \dots \\
    3q^{2} + 5q + 7 & 2q^{3} + 4q^{2} + 6q + 8 & q^{4} + 3q^{3} + 5q^{2} + 7q + 9 & \dots \\
    4q^{2} + 6q + 8 & 3q^{3} + 5q^{2} + 7q + 9 & 2q^{4} + 4q^{3} + 6q^{2} + 8q + 10 & \dots \\
    5q^{2} + 7q + 9 & 4q^{3} + 6q^{2} + 8q + 10 & 3q^{4} + 5q^{3} + 7q^{2} + 9q + 11 & \dots \\
    6q^{2} + 8q + 10 & 5q^{3} + 7q^{2} + 9q + 11 & 4q^{4} + 6q^{3} + 8q^{2} + 10q + 12 & \dots \\
    \end{pmatrix} \]
  hence
  \[ M' = \begin{pmatrix}
    3 & 4 & 5 & 6 & 7 \\
    2q + 1 & 3q + 1 & 4q + 1 & 5q + 1 & 6q + 1 \\
    q^{2} + q + 1 & 2q^{2} + q + 1 & 3q^{2} + q + 1 & 4q^{2} + q + 1 & 5q^{2} + q + 1 \\
    q^{2} + q + 1 & q^{3} + q^{2} + q + 1 & 2q^{3} + q^{2} + q + 1 & 3q^{3} + q^{2} + q + 1 & 4q^{3} + q^{2} + q + 1 \\
    q^{2} + q + 1 & q^{3} + q^{2} + q + 1 & q^{4} + \dots + 1 & 2q^{4} + \dots + 1 & 3q^{4} + \dots + 1 \\
    q^{2} + q + 1 & q^{3} + q^{2} + q + 1 & q^{4} + \dots + 1 & q^{5} + \dots + 1 & 2q^{5} + \dots + 1 \\
    q^{2} + q + 1 & q^{3} + q^{2} + q + 1 & q^{4} + \dots + 1 & q^{5} + \dots + 1 & q^{6} + \dots + 1 \\
    q^{2} + q + 1 & q^{3} + q^{2} + q + 1 & q^{4} + \dots + 1 & q^{5} + \dots + 1 & q^{6} + \dots + 1
    \end{pmatrix} \]
  and finally
  \[ M'' = \begin{pmatrix}
    3 & 4 & 5 & 6 & 7 \\
    2q + 1 & 3q + 1 & 4q + 1 & 5q + 1 & 6q + 1 \\
    q^{2} + q - 2 & 2q^{2} + q - 3 & 3q^{2} + q - 4 & 4q^{2} + q - 5 & 5q^{2} + q - 6 \\
    q^{2} - q & q^{3} + q^{2} - 2q & 2q^{3} + q^{2} - 3q & 3q^{3} + q^{2} - 4q & 4q^{3} + q^{2} - 5q \\
    0 & q^{3} - q^{2} & q^{4} + q^{3} - 2q^{2} & 2q^{4} + q^{3} - 3q^{2} & 3q^{4} + q^{3} - 4q^{2} \\
    0 & 0 & q^{4} - q^{3} & q^{5} + q^{4} - 2q^{3} & 2q^{5} + q^{4} - 3q^{3} \\
    0 & 0 & 0 & q^{5} - q^{4} & q^{6} + q^{5} - 2q^{4} \\
    0 & 0 & 0 & 0 & q^{6} - q^{5}
    \end{pmatrix}. \]
\end{example}

\begin{proof}
  In order to prove $M$ has full rank, it suffices to prove $M''$ has full rank.
  We now confirm the patterns shown by the example above.

  By quoting \Cref{cor:semi_lie_derivative_single} we will write
  \begin{align*}
    M_{i,r}
    &= \sum_{j=0}^{\min(i,r + \left\lfloor \frac{\theta}{2} \right\rfloor)}
      \left( i + \frac{v(b)+v(c)+1}{2} + r - 2j \right) q^j \\
    &- \mathbf{1}_{\substack{\theta \equiv 0 \bmod 2 \\ i \ge r + \theta/2}}
      \cdot q^{v(d-a)+r} \cdot \left( \frac{i-r}{2} + t_i \right)
  \end{align*}
  where
  \[
    t_i = \begin{cases}
      -\frac{v(d-a)}{2} &\text{if } i + r \equiv v(d-a) \pmod 2 \\
      \frac{v(b)+v(c)-3v(d-a)}{2} &\text{if } i + r \not\equiv v(d-a) \pmod 2 \\
    \end{cases}
  \]
  depends only on the parity of $i$.
  Hence for $i \ge 1$ we always have
  \begin{align*}
    M'_{i,r}
    &= M_{i,r} - M_{i-1,r} \\
    &=- \mathbf{1}_{\substack{\theta \equiv 0 \bmod 2 \\ i \ge r + \theta/2}}
      \cdot q^{v(d-a)+r} \cdot \left( \frac{i-r}{2} + t_i \right) \\
    &+ \mathbf{1}_{\substack{\theta \equiv 0 \bmod 2 \\ i-1 \ge r + \theta/2}}
      \cdot q^{v(d-a)+r} \cdot \left( \frac{i-1-r}{2} + t_{i-1} \right) \\
    &+ \mathbf{1}_{i \le r + \left\lfloor \frac{\theta}{2} \right\rfloor} \cdot
      \left( \frac{v(b)+v(c)+1}{2} + r - i \right) q^i \\
    &+ \sum_{j=0}^{\min(i-1,r + \left\lfloor \frac{\theta}{2} \right\rfloor)} q^j.
  \end{align*}
  From this we can make the following deductions
  on \[ M''_{i,r} = M'_{i,r} - M'_{i-2,r} \]
  by cancelling most of the terms.
  \begin{itemize}
    \ii If $i \ge r + \left\lfloor \frac{\theta}{2} \right\rfloor + 3$
    then $M''_{i,r} = 0$ is clear.
    \ii If $i = r + \left\lfloor \frac{\theta}{2} \right\rfloor + 2$
    we contend that $M''_{i,r} = 0$ too.
    \begin{itemize}
      \ii When $\theta = v(b) + v(c)$ is odd, the surviving terms are
      \[
        - \left( \frac{v(b)+v(c)+1}{2} + r - (i-2) \right) q^{ i-2}
        + q^{r + \left\lfloor \frac{\theta}{2} \right\rfloor}
      \]
      Substituting in $i = r + \frac{v(b)+v(c)-1}{2} + 2$ gives zero, as needed.

      \ii When $\theta = 2v(d-a)$ is even, the surviving terms are
      \begin{align*}
        &-q^{v(d-a)+r} \cdot \left( \frac{i-r}{2} + t_{i} \right)
          + q^{v(d-a)+r} \cdot \left( \frac{(i-2)-r}{2} + t_{i-2} \right) \\
        &\qquad+ q^{v(d-a)+r} \cdot \left( \frac{i-1-r}{2} + t_{i-1} \right) \\
        &\qquad- \left( \frac{v(b)+v(c)+1}{2} + r - (i-2) \right) q^{i-2} \\
        &\qquad+ q^{r + \left\lfloor \frac{\theta}{2} \right\rfloor} \\
        &= q^{v(d-a)+r} \cdot \left( -1 + \frac{i-1-r}{2} + t_{i-1} - \frac{v(b)+v(c)+1}{2} - r  + i - 2 +1 \right) \\
        &= q^{v(d-a)+r} \cdot \left( -\frac{3}{2}r + t_{i-1} - \frac{v(b)+v(c)}{2} + \frac32 i \right)
      \end{align*}
      Substituting in $i = r + v(d-a) + 2$ (and since $t_i = t_{i-2}$),
      we also get exactly $0$,
      since $t_{i-1} = \frac{v(b)+v(c)-3v(d-a)}{2}$.
    \end{itemize}

    \ii If $i = r + \left\lfloor \frac{\theta}{2} \right\rfloor + 1$,
    we consider again cases on the parity of $\theta$.
    \begin{itemize}
      \ii When $\theta = v(b)+v(c)$ is odd, the surviving terms are
      \[
        -\left( \frac{v(b)+v(c)+1}{2} + r - (i-2) \right) q^{i-2} \\
        + q^{r+\left\lfloor \frac{\theta}{2} \right\rfloor} + q^{r+\left\lfloor \frac{\theta}{2} \right\rfloor-1} \\
        = q^{r+\left\lfloor \frac{\theta}{2} \right\rfloor} - q^{r+\left\lfloor \frac{\theta}{2} \right\rfloor - 1}.
      \]

      \ii When $\theta = 2v(d-a)$ is even, the surviving terms are
      \begin{align*}
        &-q^{v(d-a)+r} \cdot \left( \frac{i-r}{2} + t_{i} \right) \\
        &\qquad+ q^{v(d-a)+r} \cdot \left( \frac{i-1-r}{2} + t_{i-1} \right) \\
        &\qquad- \left( \frac{v(b)+v(c)+1}{2} + r - (i-2) \right) q^{i-2} \\
        &\qquad+ q^{r + \left\lfloor \frac{\theta}{2} \right\rfloor}
        + q^{r + \left\lfloor \frac{\theta}{2} \right\rfloor - 1} \\
        &= \left( t_{i-1}-t_i+\half  \right) q^{r + \left\lfloor \frac{\theta}{2} \right\rfloor} \\
        &\qquad- \left( \frac{v(b)+v(c)+1}{2} + r - (i-2) - 1 \right) q^{r + \left\lfloor \frac{\theta}{2} \right\rfloor - 1} \\
        &= \left( -\frac{v(d-a)}{2} - \frac{v(b)+v(c)-3v(d-a)}{2} + \frac12 \right) q^{r + \left\lfloor \frac{\theta}{2} \right\rfloor} \\
        &\qquad- \left( \frac{v(b)+v(c)+1}{2} + r - ((r+v(d-a)+1)-2) - 1 \right) q^{r + \left\lfloor \frac{\theta}{2} \right\rfloor - 1} \\
        &= - \frac{v(b)+v(c)-1-2v(d-a)}{2} q^{r + \left\lfloor \frac{\theta}{2} \right\rfloor} \\
        &\qquad- \frac{v(b)+v(c)+1-2v(d-a)}{2} q^{r + \left\lfloor \frac{\theta}{2} \right\rfloor - 1}.
      \end{align*}
      In the edge case where $r = 0$ and $\theta \le 1$,
      it can be checked the same formula still holds with the last term omitted.
    \end{itemize}
  \end{itemize}
  Hence we have found a diagonal of $M''$ below with all entries are zero,
  and on which all entries are nonzero except possibly $M''_{1,0} = 0$
  in the case where $r = 0$ and $\theta \le 1$.

  Assuming $r + \left\lfloor \frac{\theta}{2} \right\rfloor \ge 2$,
  suppose we take the rows from $i = r + \left\lfloor \frac{\theta}{2} \right\rfloor + 1$
  up to $i = r + \left\lfloor \frac{\theta}{2} \right\rfloor + N + 1$.
  Then the resulting matrix is upper triangular.
  The determinant is the product of the diagonal entries;
  up to multiplication by sign and a power of $q$, it equals
  and the determinant is equal to
  \[
    \begin{cases}
    (q-1)^{N+1} & \text{if } \theta \equiv 1 \pmod 2 \\
    \left( \frac{v(b)+v(c)-1-2v(d-a)}{2} q + \frac{v(b)+v(c)+1-2v(d-a)}{2} \right)^{N+1} & \text{if } \theta \equiv 0 \pmod 2
    \end{cases}
  \]
  which is manifestly nonzero for any odd prime power $q$.

  In the situation where $r + \left\lfloor \frac{\theta}{2} \right\rfloor = 1$,
  we use the same rows except that we replace the row for $i=1$
  with the row for $i=0$, which has leftmost entry $M_{0,0} = \frac{v(b)+v(c)+1}{2} > 0$.
  Hence the same proof still shows that the determinant is nonzero.
\end{proof}

\subsection{Proof of \Cref{thm:semi_lie_ker_trivial}}
Suppose we are given some function
\[ \phi = \sum_{r=0}^N (-1)^r c_r \mathbf{1}_{K'_{S, \le r}} \in \HH(S_2(F)). \]
Letting $M$ be the matrix given in \Cref{lem:semi_lie_ker_full_rank},
we are supposed to have
\[ M \begin{pmatrix} c_0 \\ c_1 \\ \vdots \\ c_N \end{pmatrix} = \mathbf{0}. \]
Since $M$ has full rank, it follows that $c_0 = \dots = c_N = 0$.

\section{In the semi-Lie case, the kernel has finite codimension for fixed $v(e)$}
We start with the following lemma.
\begin{lemma}
  \label{lem:semi_lie_large_r}
  For $r \ge v(e) + 2$, we have
  \[
    \partial \Orb \left( \guv,
        \mathbf{1}_{K'_{S, \le r}} + 2 \mathbf{1}_{K'_{S, \le (r-1)}} + \mathbf{1}_{K'_{S, \le (r-2)}}
      \right) = 0.
  \]
\end{lemma}
\begin{proof}
  This follows directly from \Cref{cor:semi_lie_combo} which gives
  \begin{align*}
    \sum_{j=0}^{v(e)} q^j
    &= \frac{(-1)^r}{\log q} \partial
    \Orb \left( \guv,
      \left(\mathbf{1}_{K'_{S, \le r}} + \mathbf{1}_{K'_{S, \le (r-1)}}\right)
      \right) \\
    &= \frac{(-1)^{r-1}}{\log q} \partial
    \Orb \left( \guv,
      \left(\mathbf{1}_{K'_{S, \le (r-1)}} + \mathbf{1}_{K'_{S, \le (r-2)}}\right)
      \right). \qedhere
  \end{align*}
\end{proof}

\subsection{Proof of \Cref{thm:semi_lie_ker_huge}}
The first part of \Cref{thm:semi_lie_ker_huge} now follows directly from
\Cref{lem:semi_lie_large_r}.

It remains to show the kernel is not contained in any maximal ideal.
Again, treat $v(e)$ as fixed.
Consider the composed isomorphism from \Cref{ch:satake}
given by
\[ \HH(S_2(F)) \xrightarrow{\BC^\eta_S} \HH(\U(\VV_2^+)) \xrightarrow{\Sat} \QQ[Y + Y^{-1}]. \]
By combining \cite[Equation (7.1.9)]{ref:AFLspherical}
(which is also \Cref{lem:finale_base_change} later)
and \cite[Equation (7.1.4)]{ref:AFLspherical}
we find that
\begin{align*}
  \Sat\left(\BC^\eta_S\left(\mathbf{1}_{K', \le r} + \mathbf{1}_{K', \le (r-1)}\right)\right)
  &= (-1)^r \Sat(\mathbf{1}_{\varpi^{-r} \Mat_2(\OO_E) \cap \VV_n^+}) \\
  &= (-1)^r \left( q^r \sum_{j=-r}^r Y^j - q^{r-1} \sum_{j=-(r-1)}^{r-1} Y^j \right).
\end{align*}
Hence, if we define the polynomial
\begin{align*}
  P_r(Y) &\coloneqq (-1)^r \Sat\left(\BC^\eta_S\left(
    \mathbf{1}_{K', \le r} + 2\mathbf{1}_{K', \le (r-1)}
    + \mathbf{1}_{K', \le (r-2)} \right)\right) \\
  &= \left( q^r \sum_{j=-r}^r Y^j - q^{r-1} \sum_{j=-(r-1)}^{r-1} Y^j \right)
    - \left( q^{r-1} \sum_{j=-(r-1)}^{r-1} Y^j - q^{r-2} \sum_{j=-(r-2)}^{r-2} Y^j \right) \\
  &= q^r \sum_{j=-r}^r Y^j - 2q^{r-1} \sum_{j=-(r-1)}^{r-1} Y^j + q^{r-2} \sum_{j=-(r-2)}^{r-2} Y^j
\end{align*}
then for any $r \ge v(e)+2$,
all the polynomials $P_r(Y) - P_{v(e)+2}(Y)$ lie in the kernel.

We now prove there is no choice of a single $Y \in \CC^\times$ for which
$P_r(Y)$ is eventually constant, which would complete the proof.
Indeed, if we write
\[
  P_r(Y) - q P_{r-1}(Y)
  = q^r(Y^r + Y^{-r}) - 2q^{r-1} (Y^{r-1} + Y^{-(r-1)}) + q^{r-2}(Y^{r-2} + Y^{-(r-2)})
\]
then
\begin{align*}
  (P_r(Y) - q P_{r-1}(Y)) - (P_{r-1}(Y) - q P_{r-2}(Y))
  &= q^3(Y^r + Y^{-r}) - 3q^2(Y^{r-1} + Y^{-(r-1)}) \\
  &\qquad + 3q(Y^{r-2} + Y^{-(r-2)}) - (Y^{r-3} + Y^{-(r-3)}).
\end{align*}
So we are done after we prove the following standalone lemma.
\begin{lemma}
  There is no $Y \in \CC^\times$ such that
  \[ q^3(Y^r + Y^{-r}) - 3q^2(Y^{r-1} + Y^{-(r-1)})
    + 3q(Y^{r-2} + Y^{-(r-2)}) - (Y^{r-3} + Y^{-(r-3)}) = 0 \]
  holds for all sufficiently large integers $r$.
\end{lemma}
\begin{proof}
  Assume for contradiction such a $Y \in \CC^\times$ existed.
  Let $Y^{\pm k} \coloneqq Y^k + Y^{-k}$ for brevity for every integer $k \ge 1$.
  By writing the recursion relations
  \begin{align*}
    Y^{\pm (r-1)} &= Y^{\pm 1} \cdot Y^{\pm (r-2)} - Y^{\pm (r-3)} \\
    Y^{\pm r} &= Y^{\pm 1} \cdot Y^{\pm (r-1)} - Y^{\pm (r-2)} \\
    &= ((Y^{\pm 1})^2 - 1) \cdot Y^{\pm (r-2)} - Y^{\pm 1} \cdot Y^{\pm (r-3)}
  \end{align*}
  we can deduce that
  \begin{align*}
    0 &= q^3 \cdot Y^{\pm r} - 3q^2 \cdot Y^{\pm (r-1)} + 3q \cdot Y^{\pm (r-2)} - Y^{\pm (r-3)} \\
    &= \left[ q^3 \cdot \left( (Y^{\pm 1})^2 - 1 \right)
      - 3q^2 \cdot Y^{\pm 1} + 3q \right] \cdot Y^{\pm (r-2)}
    - \left[ q^3 \cdot Y^{\pm 1} - 3q^2 + 1 \right] \cdot Y^{\pm (r-3)}.
  \end{align*}

  Now, in general there is no complex number $Y \in \CC^\times$ such that
  $Y^r + Y^{-r} = 0$ for two consecutive values of $r$.
  Hence, if either bracketed coefficient is zero, then so must be the other one.
  However, in that case, we would conclude that
  $Y^{\pm 1} = \frac{3q^2-1}{q^3}$ from the second bracketed coefficient, meaning
  \[ 0 = q^3 \cdot \left( \left( \frac{3q^2-1}{q^3} \right)^2 - 1 \right)
    - 3q^2 \cdot \frac{3q^2-1}{q^3} + 3q = \frac{(q^2-1)^3}{q^3} \]
  which is a contradiction, because $q > 1$.

  Hence neither bracketed coefficient can be zero,
  from which we conclude that there is some nonzero constant $c$ such that
  \[ Y^{\pm (r-2)} = c \cdot Y^{\pm(r-3)} \neq 0 \]
  holds for all large $r$.
  But then
  \[ c \cdot Y^{\pm(r-3)}
    = Y^{\pm 1} \cdot Y^{\pm (r-3)} - Y^{\pm (r-4)}
    = Y^{\pm 1} \cdot Y^{\pm (r-3)} - \frac{Y^{\pm (r-3)}}{c} \]
  and hence $c = Y^{\pm 1} - \frac 1c$.
  So either $c = Y$ or $c = \frac 1Y$.
  Then from $Y^{\pm (r-2)} = c \cdot Y^{\pm(r-3)}$ we derive that $Y = \pm 1$.

  But substituting $Y = 1$ in the original equation would imply $(q-1)^3 = 0$
  while $Y = -1$ would imply $(q+1)^3 = 0$ neither of which is possible.
  This contradiction completes the proof of the lemma.
\end{proof}

\section{A sequence of test functions almost lying in the kernel in the semi-Lie case}
We make one additional remark on the kernel that unifies both of the preceding two sections.
For this section, we define the following indicator function for $r \ge 3$:
\[ \phi_r \coloneqq \mathbf{1}_{K', \le r} + \mathbf{1}_{K', \le (r-1)}
   - q^2 (\mathbf{1}_{K', \le (r-2)} + \mathbf{1}_{K', \le (r-3)}). \]
We give the following theorem which can be thought of as a simultaneously
refined version of both \Cref{lem:semi_lie_ker_full_rank} and
\Cref{lem:semi_lie_large_r}.
Roughly, it says that we can define a sequence of test functions
\[ \phi_r + (q+1)\phi_{r-1} + q\phi_{r-2} \qquad r \ge 5 \]
such that for any fixed $\guv$, there are at most three values of $r$
for which the orbital integral does not vanish.
\begin{theorem}
  \label{thm:semi_lie_finite_codim_full}
  Suppose $\guv \in (S_2(F) \times V_2'(F))\rs$ is as in \Cref{lem:semi_lie_params}.
  Then
  \[ \partial \Orb \left( \guv, \phi_r + (q+1)\phi_{r-1} + q\phi_{r-2} \right) = 0 \]
  holds for all $r \ge 5$ with at most three exceptions,
  namely those $r$ with
  \[ v(e) - \min\left(\frac{v(b)+v(c)-1}{2}, v(d-a)\right) + 2
    \le r \le v(e) - \min\left(\frac{v(b)+v(c)-1}{2}, v(d-a)\right) + 4. \]
\end{theorem}
\begin{proof}
  As always $\theta \coloneqq \min\left( v(b)+v(c), 2v(d-a) \right)$
  as in \Cref{ch:orbitalFJ1}.
  Consider \Cref{cor:semi_lie_combo}, and let $N$, $C$, $C'$ be as in the statement.
  Let $N^{\flat\flat}$, $C^{\flat\flat}$, $(C')^{\flat\flat}$
  be the changes to those constants when one replaces $r$ by $r-2$.
  Then one can record the changes to these parameters explicitly, see \Cref{tab:semi_lie_change_by_two}.

  \begin{table}
    \begin{tabular}{lll}
      \toprule
      Assumptions & Parameters for $r$ & Parameters for $r-2$ \\
      \toprule
      $r \ge v(e) - \left\lfloor \tfrac{\theta}{2} \right\rfloor + 3$
        & $\begin{aligned} N &= v(e) \\ C &= C' = 0 \end{aligned}$
        & $\begin{aligned} N^{\flat\flat} &= v(e) \\ C^{\flat\flat} &= (C')^{\flat\flat} = 0 \end{aligned}$ \\
      \midrule
      $\begin{aligned} r &= v(e) - \left\lfloor \tfrac{\theta}{2} \right\rfloor + 2 \\ \theta &= 2v(d-a) \\ &\text{(exceptional)} \end{aligned}$
        & $\begin{aligned} N &= v(e) \\ C &= C' = 0 \end{aligned}$
        & $\begin{aligned} N^{\flat\flat} &= (r-2) + \left\lfloor \tfrac{\theta}{2} \right\rfloor = v(e) \\
          C^{\flat\flat} &= \tfrac{-1 + (v(b)+v(c)-2v(d-a))}{2} \\
          (C')^{\flat\flat} &= C^{\flat\flat}+1 \end{aligned}$ \\
      \midrule
      $\begin{aligned} r &= v(e) - \left\lfloor \tfrac{\theta}{2} \right\rfloor + 1 \\ \theta &= 2v(d-a) \end{aligned}$
        & $\begin{aligned} N &= v(e) \\ C &= C' = 0 \end{aligned}$
        & $\begin{aligned} N^{\flat\flat} &= (r-2) + \left\lfloor \tfrac{\theta}{2} \right\rfloor =v(e)-1 \\
          C^{\flat\flat} &= 0 \\
          (C')^{\flat\flat} &= 1 \end{aligned}$ \\
      \midrule
      $\begin{aligned} r &\le v(e) - \left\lfloor \tfrac{\theta}{2} \right\rfloor \\ \theta &= 2v(d-a) \\ \varkappa &\equiv 0 \pmod 2 \end{aligned}$
        & $\begin{aligned} N &= r + \left\lfloor \tfrac{\theta}{2} \right\rfloor \\
          C &= \tfrac{\varkappa-1 + (v(b)+v(c)-2v(d-a))}{2} \\
          C' &= C+1 \end{aligned}$
        & $\begin{aligned} N^{\flat\flat} &= (r-2) + \left\lfloor \tfrac{\theta}{2} \right\rfloor \\
          C^{\flat\flat} &= \tfrac{(\varkappa-2)-1 + (v(b)+v(c)-2v(d-a))}{2} \\
          (C')^{\flat\flat} &= C^{\flat\flat}+1 \end{aligned}$ \\
      \midrule
      $\begin{aligned} r &\le v(e) - \left\lfloor \tfrac{\theta}{2} \right\rfloor \\ \theta &= 2v(d-a) \\ \varkappa &\equiv 1 \pmod 2 \end{aligned}$
        & $\begin{aligned} N &= r + \left\lfloor \tfrac{\theta}{2} \right\rfloor \\
          C &= \tfrac{\varkappa-1}{2} \\
          C' &= C+1 \end{aligned}$
        & $\begin{aligned} N^{\flat\flat} &= (r-2) + \left\lfloor \tfrac{\theta}{2} \right\rfloor \\
          C^{\flat\flat} &= \tfrac{(\varkappa-2)-1}{2} \\
          (C')^{\flat\flat} &= C^{\flat\flat}+1 \end{aligned}$ \\
      \midrule
      $\begin{aligned} r &\le v(e) - \left\lfloor \tfrac{\theta}{2} \right\rfloor \\ \theta &= v(b)+v(c) \end{aligned}$
        & $\begin{aligned} N &= r + \left\lfloor \tfrac{\theta}{2} \right\rfloor \\
          C &= v(e) - \left\lfloor \tfrac{\theta}{2} \right\rfloor + r \\
          C' = 0 \end{aligned}$
        & $\begin{aligned} N^{\flat\flat} &= (r-2) + \left\lfloor \tfrac{\theta}{2} \right\rfloor \\
          C^{\flat\flat} &= v(e) - \left\lfloor \tfrac{\theta}{2} \right\rfloor + (r-2) \\
          (C')^{\flat\flat} &= 0 \end{aligned}$ \\
      \bottomrule
    \end{tabular}
    \caption{Comparison of $N$ to $N^{\flat\flat}$, etc.,
      needed to carry out the proof of \Cref{thm:semi_lie_finite_codim_full}.
      Note the exceptional case $r = v(e) - \left\lfloor \frac{\theta}{2} \right\rfloor + 2$
      differs from all the others because $C-C^{\flat\flat}$ can be large.}
    \label{tab:semi_lie_change_by_two}
  \end{table}
  Note in particular except for the single exceptional value
  $r = v(e) - \left\lfloor \frac{\theta}{2} \right\rfloor + 2$
  we should always have $(N^{\flat\flat}+2)-N \in \{0,1,2\}$,
  $C - C^{\flat\flat} \in \{0,1,2\}$, $(C') - (C')^{\flat\flat} \in \{0,1\}$.
  More explicitly, we have the following result from \Cref{tab:semi_lie_change_by_two}
  for every $r \ge 3$:
  \begin{align*}
    &\frac{(-1)^{r+v(c)}}{\log q}
    \partial \Orb \left( \guv, \phi_r \right) \\
    &=
    \begin{cases}
      -q^{r+\left\lfloor \frac{\theta}{2} \right\rfloor} -q^{r+\left\lfloor \frac{\theta}{2} \right\rfloor - 1} + q + 1
        & \text{if } r \le v(e) - \left\lfloor \frac{\theta}{2} \right\rfloor + 1 \text{ and } \theta = v(b)+v(c) \\
      -2q^{r+\left\lfloor \frac{\theta}{2} \right\rfloor} + q + 1 & \text{if } r \le v(e) - \left\lfloor \frac{\theta}{2} \right\rfloor + 1 \text{ and } \theta = 2v(d-a) \\
      -q^{v(e)+2} - q^{v(e)+1} + q + 1  & \text{if } r \ge v(e) - \left\lfloor \frac{\theta}{2} \right\rfloor + 3.
    \end{cases}
  \end{align*}
  It follows that for $r \ge v(e) - \left\lfloor \frac{\theta}{2} \right\rfloor + 4$ we have
  \begin{equation}
    \frac{(-1)^{r+v(c)}}{\log q}
    \partial \Orb \left( \guv, \phi_r + \phi_{r-1} \right) = 0
    \label{eq:semi_lie_finite_codim_large_r}
  \end{equation}
  while when $r \le v(e) - \left\lfloor \frac{\theta}{2} \right\rfloor + 1$ we have
  \begin{equation}
    \frac{(-1)^{r+v(c)}}{\log q}
    \partial \Orb \left( \guv, \phi_r + q\phi_{r-1} \right)
    = 1-q^2.
    \label{eq:semi_lie_finite_codim_small_r}
  \end{equation}
  Then \Cref{thm:semi_lie_finite_codim_full} follows directly
  from \eqref{eq:semi_lie_finite_codim_large_r} and \eqref{eq:semi_lie_finite_codim_small_r}.
\end{proof}
\section{Proof of \Cref{thm:no_kernel_group} for the group AFL}
We give a proof in this section that no nonzero $\phi \in \HH(S_3(F))$ can satisfy
\[ \partial \Orb(\gamma, \phi) = 0 \]
for every $\gamma \in S_3(F)\rs$ pairing to an element of $\U(\VV_3^-)$.
The proof is actually quite short.
Suppose that
\[ \phi = \sum_{r=0}^N a_j \mathbf{1}_{K'_{S, \le r}} \]
for some $N > 0$.
We pick our $\gamma$ according to \Cref{lem:S3_abcd} subject to
\[ v(b) = v(d) = -N. \]
In that case, we have
\[ \Orb(\gamma, \mathbf{1}_{K'_{S, \le r}}, s) = 0 \text{ for all } r = 0, 1, \dots, N-1 \]
and so there is certainly no contribution to its derivative.
However, for $a_N$ according to \Cref{ex:ell_neg_top_case} we have
\[
  \partial \Orb(\gamma, \mathbf{1}_{K'_{S, \le N}})
  = \left. \pdv{}{s} \right\rvert_{s=0}
  \left( \sum_{k=-r}^{\lambda-2r} (-1)^k (q^s)^k \right)
  = (-1)^{r+1} \cdot \frac{\lambda+1}{2} \neq 0.
\]
Hence $N > 0$ cannot hold.

For $N=0$, we instead take, say, $\ell = \delta = 1$ in \Cref{thm:full_orbital_ell_odd}
in which case $\Orb(\gamma, \mathbf{1}_{K'_S}, s) = -q^{3s} + q^{2s} - q^s + 1$
whose derivative is $-2$.
The proof is complete.

\section{A sequence of test functions almost lying in the kernel in the group AFL case}
We mention the following $S_3(F)$ analog of \Cref{thm:semi_lie_finite_codim_full}.
\begin{proposition}
  Choose $\gamma \in S_3(F)\rs$ match an orbit of $\U(\VV_3^-)$
  and let $\ell$ be as in \Cref{lem:S3_abcd}.
  If $\ell \ge 0$, then for any $r \ge 3$,
  \[ \partial \Orb\left(\gamma, \mathbf{1}_{K'_{S, r}} + 2q \mathbf{1}_{K'_{S, r-1}}
    + q^2 \mathbf{1}_{K'_{S, r-2}}\right) = (2q+2) \log q. \]
  The result also holds for $\ell < 0$ with at most three exceptions for $r$,
  namely $-\half\ell \le r \le -\half\ell + 2$.
\end{proposition}
\begin{proof}
  \todo{write this proof}
\end{proof}

In the spirit of the conjecture proposed in \cite[Conjecture 1.0.2]{ref:AFLspherical},
we mention the following result as well.

\begin{proposition}
  The subspace of $\HH(S_3(F))$ spanned by
  \[ \mathbf{1}_{K'_{S, r}} + 2q \mathbf{1}_{K'_{S, r-1}} + \mathbf{1}_{K'_{S, r-2}} \]
  for $r \ge 3$ is (in addition to being of codimension at most $3$)
  not contained in any maximal ideal of $\HH(S_3(F))$.
\end{proposition}

\begin{proof}
  This requires us to invoke the explicit results from \Cref{ch:satake}.
  Consider the composed isomorphisms
  \[ \HH(S_3(F)) \xrightarrow{\BC_S} \HH(\U(\VV_3^+)) \xrightarrow{\Sat} \QQ[Y + Y^{-1}]. \]
  Let $K =  \GL_n(\OO_E) \cap \U(\VV_3^+)$ and note for any $r \ge 2$ we have
  \begin{align*}
    \mathbf{1}_{K\varpi^{(r,0,-r)}K}
    &\xmapsto{\BC_S^{-1}}
    \mathbf{1}_{K'_{S, r}} + 2q \mathbf{1}_{K'_{S, r-1}} + 2q^2 \mathbf{1}_{K'_{S, r-2}} + 2q^3 \mathbf{1}_{K'_{S, r-3}} + \dots \\
    \implies
    \mathbf{1}_{K\varpi^{(r,0,-r)}K} - q^2 \mathbf{1}_{K\varpi^{(r-2,0,-(r-2))}K}
    &\xmapsto{\BC_S^{-1}}
    \mathbf{1}_{K'_{S, r}} + 2q \mathbf{1}_{K'_{S, r-1}} + q^2 \mathbf{1}_{K'_{S, r-2}}.
  \end{align*}
  Hence for $r \ge 3$ if we define
  \begin{align*}
    P_r(Y) &\coloneqq \Sat\left(\BC_S(\mathbf{1}_{K'_{S, r}}
      + 2q \mathbf{1}_{K'_{S, r-1}} + q^2 \mathbf{1}_{K'_{S, r-2}})\right) \\
    &= \Sat\left( \mathbf{1}_{K\varpi^{(r,0,-r)}K} - q^2 \mathbf{1}_{K\varpi^{(r-2,0,-(r-2))}K} \right) \\
    &= \Sat\Big(
      \mathbf{1}_{\varpi^{-r} \Mat_3(\OO_E) \cap \U(\VV_3^+)}
      - \mathbf{1}_{\varpi^{-(r-1)} \Mat_3(\OO_E) \cap \U(\VV_3^+)} \\
      &\qquad- q^2 \mathbf{1}_{\varpi^{-(r-2)} \Mat_3(\OO_E) \cap \U(\VV_3^+)}
      + q^2 \mathbf{1}_{\varpi^{-(r-3)} \Mat_3(\OO_E) \cap \U(\VV_3^+)}
      \Big) \\
    &= \left( q^{2r} \sum_{j=-r}^r Y^j + q^{2r-1} \sum_{j=-(r-1)}^{r-1} Y^j \right)
    - \left( q^{2r-2} \sum_{j=-(r-1)}^{r-1} Y^j + q^{2r-3} \sum_{j=-(r-2)}^{r-2} Y^j \right) \\
    &\qquad- \left( q^{2r-2} \sum_{j=-(r-2)}^{r-2} Y^j + q^{2r-3} \sum_{j=-(r-3)}^{r-3} Y^j \right)
    + \left( q^{2r-4} \sum_{j=-(r-3)}^{r-3} Y^j + q^{2r-5} \sum_{j=-(r-4)}^{r-4} Y^j \right)
  \end{align*}
  then it follows that $P_r(Y) - P_3(Y)$ is contained in the kernel for any $r \ge 3$.

  To show this kernel generates the entire ring, it would be sufficient to prove
  there is no $Y \in \CC^\times$ such that $P_3(Y) = P_4(Y) = P_5(Y) = P_6(Y) = \dotsb$.
  However, using the explicit formula for $P_r(Y)$ above,
  a direct calculation gives the following two identities:
  \begin{align*}
    P_5(Y) - \frac{q^2}{Y} P_4(Y) - q^2 Y P_4(Y) - \frac{q^2}{Y} P_3(Y) &= -q^5 \\
    P_6(Y) - \frac{q^2}{Y} P_5(Y) - q^2 Y P_5(Y) - \frac{q^2}{Y} P_4(Y) &= 0.
  \end{align*}
  So such a common root $Y$ cannot exist.
\end{proof}
