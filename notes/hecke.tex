\section{Petersson inner product}
We will now make the space of modular/cusp forms
into a Hilbert space.

\subsection{Poincar\'{e} metric}
The space $\HH$ is usually endowed with the metric
\[ d\mu = \frac{dx \; dy}{y^2}. \]
The reason is that:
\begin{proposition}
  This measure is invariant under the action of $\SL_2(\RR)$.
\end{proposition}
\begin{proof}
  Let $\gamma = \abcd \in \SL_2(\RR)$ and let $S \subseteq \HH$ be measurable.
  Define $u(x,y) = \Re \gamma(z)$ and $v(x,y) = \Im \gamma(z)$.
  We wish to show
  \[ \int_{\gamma(S)} \frac{du \; dv}{v^2} = \int_S \frac{dx \; dy}{y^2}. \]
  The change-of-variables formula implies that
  the right-hand side can be transformed by multiplying by Jacobian:
  \[ \int_{\gamma(S)} \frac{du \; dv}{v^2} = \int_{S}
    \frac{1}{v(x,y)^2}
    \det \begin{bmatrix}
      \frac{\partial u}{\partial x} & \frac{\partial u}{\partial y} \\
      \frac{\partial v}{\partial x} & \frac{\partial v}{\partial y}
    \end{bmatrix} dx \; dy
  \]
  At this point, we can verify the identity by just bashing everything out.
  However, this is almost comedically painful. Instead, a clever way to
  do this is to observe that
  \[\frac{d\gamma(z)}{dz}
    = \frac{\partial u}{\partial x} + i\frac{\partial v}{\partial x}
    = \frac{\partial v}{\partial y} - i\frac{\partial u}{\partial y}, \]
  (incidentally, this is how you derive the Cauchy-Riemann equations),
  so the Jacobian determinant is just
  \[ \frac{\partial u}{\partial x}\frac{\partial v}{\partial y}
    - \frac{\partial u}{\partial y}\frac{\partial v}{\partial x}
    = \left|\frac{d\gamma(z)}{dz}\right|^2
    = \frac{1}{|cz+d|^4}. \]
  One then verifies that $v(x,y) = y/|cz+d|^2$, and the identity follows.
\end{proof}
This makes it possible to integrate over $\Gamma \backslash \HH$
whenever $\Gamma$ is a congruence subgroup.

We may as well do the following classical calculation now.
\begin{proposition}
  We have $\int_{\Gamma(1) \backslash \HH} \frac{dx \; dy}{y^2} = \frac13\pi^2$.
\end{proposition}
\begin{proof}
  Take the classical fundamental domain\dots
  %% TODO practice integrating
\end{proof}

We won't need the value, just the finiteness.

\subsection{The Petersson inner product}
\begin{definition}
If $\Gamma$ is a congruence subgroup of $\SL_2(\ZZ)$
and $f,g \in S_k(\Gamma)$ we define the Petersson inner product by
\[ \left< f,g \right>
  = \frac{1}{[\Gamma(1):\Gamma(N)]} \int_{\Gamma(N) \backslash \HH}
  f(z) \ol{g(z)} \frac{dx \; dy}{y^2} \]
where $N$ is large enough that $f$ and $g$ are modular forms for $\Gamma(N)$.
\end{definition}
Here, the stupid identity implies $f(z) \ol{g(z)} y^k$ is invariant under
the action of $\Gamma(N)$, so this is well-defined.
In addition, because $f(z)$ and $g(z)$ decay rapidly as $z \to \infty$ (they are cusp forms),
the integral is bounded on the typical (and hence every) fundamental domain of $\Gamma(1)$,
and thus converges.

\subsection{Genus} %% ???
%% TODO exercise 1.3.8 here I guess

\section{Hecke operators for $\Gamma(1)$}
\subsection{Double cosets of $\Gamma(1)$ in $\GL_2^+(\QQ)$}
In order to define the Hecke operators,
we'll need to discuss \emph{double cosets} of $\GL_2^+(\QQ)$.
It turns out we can actually just describe
all the double cosets of $\Gamma(1) \backslash \GL_2^+(\QQ) / \Gamma(1)$.

\begin{theorem}
  [Complete description of double cosets of $\Gamma(1)$ in $\GL_2^+(\QQ)$]
  The double coset
  $\Gamma(1) \begin{bmatrix} d_1 & 0 \\ 0 & d_2 \end{bmatrix} \Gamma(1)$
  consists of all matrices $\abcd \in \GL_2^+(\QQ)$
  with determinant $d_1d_2$ and $\gcd(a,b,c,d) = d_2$
  (with $\gcd$ defined over the rational numbers).

  Consequently, there is a disjoint union
  \[ \GL_2^+(\QQ)
    = \bigsqcup_{d_1 \mid d_2}
    \Gamma(1)
    \begin{bmatrix}
      d_1 & 0 \\ 0 & d_2
    \end{bmatrix}
    \Gamma(1).
  \]
\end{theorem}
\begin{proof}
  %% TODO this is an exercise
\end{proof}

\begin{theorem}
  [Double coset partition into right cosets]
  If $d_1$ and $d_2$ are positive integers with $d_2 \mid d_1$ then
  \[ \Gamma(1) \begin{bmatrix} d_1 & 0 \\ 0 & d_2 \end{bmatrix} \Gamma(1)
    = \bigsqcup_{\substack{a,d > 0 \\
      ad = d_1d_2 \\
      b \bmod d \\
      \gcd(a,b,d)=d_2}}
    \Gamma(1) \begin{bmatrix} a & b \\ 0 & d \end{bmatrix}.  \]
\end{theorem}
If $d_1$ and $d_2$ are not integers,
then one can factor out the common denominator
and then appeal to the theorem.
\begin{proof}
  %% TODO this is an exercise
\end{proof}

Okay, that is all for double cosets for now.

\subsection{The Hecke operator}
\[
  (T(n) f)(z) = \sum_{ad=n}\sum_{b \bmod d} \left( \frac ad \right)^{k/2}
  f\left( \frac{az+b}{d} \right).
\]
Also defined via double cosets.

\begin{proposition}
  The Hecke operators commute,
  and are self-adjoint.
\end{proposition}
This means you can find a basis of eigen-stuff.

If $f$ is a Hecke eigenform, that means it has an eigenvalue $\lambda(n)$.
We can then expand and normalize the coefficients:
$A(1) \neq 0$, and scaling so that $A(1)=1$, we have $A(\bullet)$ is multiplicative and
\[ L(s,f) = \prod_p \left( 1 - A(p) p^{-s} + p^{k-1-2s} \right)\inv. \]
